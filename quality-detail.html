<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Safety & Quality - Shelford Group Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root { --shelford-teal: #007B7F; --shelford-dark-teal: #005A5D; --shelford-sage: #5B7F6C; --shelford-cream: #FDFBF7; --text-dark: #1A1A1A; --text-mid: #4A4A4A; --border-light: #E5E5E5; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: var(--shelford-cream); color: var(--text-dark); line-height: 1.6; padding: 2rem; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem; padding-bottom: 2rem; border-bottom: 3px solid var(--shelford-teal); }
        .logo-link { display: inline-block; } .logo { width: 120px; height: auto; }
        h1 { font-size: 2.5rem; color: var(--shelford-dark-teal); font-weight: 700; }
        .subtitle { font-size: 1.1rem; color: var(--text-mid); margin-top: 0.5rem; }
        h2 { font-size: 1.8rem; color: var(--shelford-dark-teal); margin: 3rem 0 1rem 0; font-weight: 600; }
        h3 { font-size: 1.3rem; color: var(--shelford-dark-teal); margin: 1rem 0; }
        .source-note { font-size: 0.9rem; color: var(--text-mid); margin-top: 0.5rem; margin-bottom: 1.5rem; font-style: italic; }
        nav { background: white; padding: 1rem 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,123,127,0.08); }
        nav a { color: var(--shelford-teal); text-decoration: none; font-weight: 500; padding: 0.5rem 1rem; transition: all 0.2s; display: inline-block; }
        nav a:hover { background: rgba(0,123,127,0.1); border-radius: 6px; }
        nav a.active { color: var(--shelford-dark-teal); background: rgba(0,123,127,0.1); border-radius: 6px; font-weight: 600; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem; }
        .metric-card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,123,127,0.08); border-left: 4px solid var(--shelford-teal); }
        .metric-label { font-size: 0.9rem; color: var(--text-mid); margin-bottom: 0.5rem; font-weight: 500; }
        .metric-value { font-size: 2.5rem; color: var(--shelford-dark-teal); font-weight: 700; margin-bottom: 0.25rem; }
        .metric-benchmark { font-size: 0.85rem; color: var(--text-mid); }
        .table-container { background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,123,127,0.08); margin-bottom: 3rem; overflow-x: auto; }
        .sort-buttons { margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .sort-btn { padding: 0.5rem 1rem; background: var(--shelford-teal); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: background 0.2s; }
        .sort-btn:hover { background: var(--shelford-dark-teal); } .sort-btn.active { background: var(--shelford-dark-teal); }
        table { width: 100%; border-collapse: collapse; } thead { background: var(--shelford-teal); color: white; }
        th { padding: 1rem; text-align: left; font-weight: 600; } td { padding: 1rem; border-bottom: 1px solid var(--border-light); }
        tbody tr:hover { background: rgba(0,123,127,0.05); } .trust-name { font-weight: 500; }
        .chart-container { background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,123,127,0.08); margin-bottom: 3rem; }
        .chart-wrapper { position: relative; height: 400px; margin-top: 1rem; }
        .chart-controls { margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .chart-btn { padding: 0.5rem 1rem; background: var(--shelford-teal); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: background 0.2s; }
        .chart-btn:hover { background: var(--shelford-dark-teal); }
        footer { margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-light); text-align: center; color: var(--text-mid); font-size: 0.9rem; }
        @media (max-width: 768px) { body { padding: 1rem; } h1 { font-size: 1.8rem; } .metric-value { font-size: 2rem; } .chart-wrapper { height: 300px; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="logo-link"><img src="shelford-logo.jpg" alt="Shelford Group" class="logo"></a>
            <div><h1>Patient Safety & Quality</h1><p class="subtitle">Patient experience and learning from patient safety events</p></div>
        </header>
        <nav><div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
            <a href="index.html">Overview</a><a href="rtt-detail.html">RTT & Elective Care</a><a href="ae-detail.html">A&E & Urgent Care</a><a href="cancer-detail.html">Cancer Services</a><a href="quality-detail.html" class="active">Patient Safety & Quality</a><a href="capacity-detail.html">Capacity & Beds</a><a href="workforce-detail.html">Workforce</a><a href="research-detail.html">Research &amp; Clinical Trials</a><a href="productivity-detail.html">Productivity</a>
        </div></nav>

        <!-- KPI Summary -->
        <h2>Patient Experience &amp; Safety Summary</h2>
        <p class="source-note">Source: NHS England Friends &amp; Family Test MacroWebfiles, December 2025; Learning from Patient Safety Events Quarterly Publication, Q2 2025/26</p>
        <div class="dashboard-grid">
            <div class="metric-card"><div class="metric-label">FFT: A&amp;E Recommend</div><div class="metric-value">80.7%</div><div class="metric-benchmark">Shelford average, December 2025 · England: 78.2%</div></div>
            <div class="metric-card"><div class="metric-label">FFT: Inpatient Recommend</div><div class="metric-value">94.9%</div><div class="metric-benchmark">Shelford average, December 2025 · England: 94.8%</div></div>
            <div class="metric-card"><div class="metric-label">Safety Event Recording Rate</div><div class="metric-value">66.7</div><div class="metric-benchmark">Per 1,000 bed days · Shelford average, Q2 2025/26</div></div>
        </div>

        <!-- Combined Performance Table -->
        <h2>Trust-Level Quality Performance</h2>
        <p class="source-note">Source: NHS England FFT MacroWebfiles (A&amp;E and Inpatient), December 2025; Learning from Patient Safety Events, Q2 2025/26</p>
        <div class="table-container">
            <div class="sort-buttons">
                <button class="sort-btn active" onclick="sortTable('alpha', event)">A-Z</button>
                <button class="sort-btn" onclick="sortTable('fftae', event)">Sort by FFT A&amp;E</button>
                <button class="sort-btn" onclick="sortTable('fftip', event)">Sort by FFT IP</button>
                <button class="sort-btn" onclick="sortTable('safetyRate', event)">Sort by Safety Rate</button>
            </div>
            <table><thead><tr><th>Trust</th><th>FFT A&amp;E %</th><th>FFT Inpatient %</th><th>Safety Events</th><th>Bed Days</th><th>Rate (per 1,000)</th></tr></thead>
            <tbody id="qualityTableBody"></tbody></table>
        </div>

        <!-- FFT Charts -->
        <h2>Patient Experience – Friends &amp; Family Test</h2>

        <div class="chart-container"><h3>Friends &amp; Family Test – Recommendation Rates by Trust</h3>
            <p class="source-note">Source: NHS England FFT MacroWebfiles (A&amp;E and Inpatient), December 2025 (published February 2026). Shows % of respondents rating experience as 'Good' or 'Very Good'.</p>
            <div class="chart-wrapper"><canvas id="fftChart"></canvas></div></div>

        <!-- Patient Safety Events -->
        <h2>Learning from Patient Safety Events</h2>

        <div class="chart-container"><h3>Patient Safety Event Recording Rate by Trust</h3>
            <p class="source-note">Source: NHS England Learning from Patient Safety Events Quarterly Publication, Q2 2025/26. Rate per 1,000 bed days. Higher rates generally indicate a stronger reporting culture.</p>
            <div class="chart-controls"><button class="chart-btn" onclick="sortSafetyChart('alpha')">A-Z</button><button class="chart-btn" onclick="sortSafetyChart('highest')">Highest to Lowest</button><button class="chart-btn" onclick="sortSafetyChart('lowest')">Lowest to Highest</button></div>
            <div class="chart-wrapper"><canvas id="safetyRateChart"></canvas></div></div>

        <div class="chart-container"><h3>Safety Events, Bed Days and Recording Rate by Trust</h3>
            <p class="source-note">Source: NHS England Learning from Patient Safety Events Quarterly Publication, Q2 2025/26. Bars show event counts and bed days (activity denominator); line shows the resulting rate per 1,000 bed days.</p>
            <div class="chart-wrapper"><canvas id="safetyVolumeChart"></canvas></div></div>

        <footer><p>&copy; 2026 Shelford Group | Data updated February 2026</p></footer>
    </div>

    <script>
        // Quality data - all verified from source files
        // FFT: NHS England FFT MacroWebfiles (A&E and Inpatient), December 2025
        // Safety: NHS England Learning from Patient Safety Events Q2 2025/26
        // ratio = incidents / bedDays (raw proportion, i.e. rate per 1 bed day)
        const qualityData = [
            { name: 'Birmingham', fftAE: 71.5, fftIP: 92.3, safetyRate: 60.9, safetyLag: 1, incidents: 15421, bedDays: 253424 },
            { name: 'Cambridge', fftAE: 82.6, fftIP: 94.6, safetyRate: 67.1, safetyLag: 0, incidents: 6123, bedDays: 91277 },
            { name: 'GSTT', fftAE: 88.2, fftIP: 96.1, safetyRate: 74.5, safetyLag: 1, incidents: 7227, bedDays: 97013 },
            { name: 'Imperial', fftAE: 85.8, fftIP: 95.9, safetyRate: 71.0, safetyLag: 1, incidents: 6658, bedDays: 93829 },
            { name: "King's", fftAE: 74.9, fftIP: 95.7, safetyRate: 61.2, safetyLag: 0, incidents: 7095, bedDays: 115967 },
            { name: 'Manchester', fftAE: 84.4, fftIP: 97.5, safetyRate: 85.7, safetyLag: 0, incidents: 15554, bedDays: 181427 },
            { name: 'Newcastle', fftAE: 73.7, fftIP: 96.0, safetyRate: 42.6, safetyLag: 1, incidents: 4815, bedDays: 113049 },
            { name: 'Oxford', fftAE: 84.1, fftIP: 94.0, safetyRate: 80.6, safetyLag: 0, incidents: 7479, bedDays: 92755 },
            { name: 'Sheffield', fftAE: 76.6, fftIP: 90.4, safetyRate: 60.2, safetyLag: 0, incidents: 7247, bedDays: 120377 },
            { name: 'UCLH', fftAE: 85.3, fftIP: 96.4, safetyRate: 63.2, safetyLag: 0, incidents: 3855, bedDays: 60997 }
        ];

        // Sortable table
        function sortTable(sortType, e) {
            let sorted = [...qualityData];
            if (sortType === 'fftae') sorted.sort((a, b) => b.fftAE - a.fftAE);
            else if (sortType === 'fftip') sorted.sort((a, b) => b.fftIP - a.fftIP);
            else if (sortType === 'safetyRate') sorted.sort((a, b) => b.safetyRate - a.safetyRate);
            document.getElementById('qualityTableBody').innerHTML = sorted.map(t =>
                '<tr><td class="trust-name">'+t.name+'</td><td>'+t.fftAE+'%</td><td>'+t.fftIP+'%</td><td>'+t.incidents.toLocaleString()+'</td><td>'+t.bedDays.toLocaleString()+'</td><td>'+t.safetyRate+'</td></tr>'
            ).join('');
            if (e) { document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active')); e.target.classList.add('active'); }
        }
        sortTable('alpha', null);

        // FFT Chart
        new Chart(document.getElementById('fftChart'), { type: 'bar', data: { labels: qualityData.map(d=>d.name), datasets: [{ label: 'A&E Recommend %', data: qualityData.map(d=>d.fftAE), backgroundColor: '#007B7F', borderRadius: 6 },{ label: 'Inpatient Recommend %', data: qualityData.map(d=>d.fftIP), backgroundColor: '#5B7F6C', borderRadius: 6 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: false, min: 65, max: 100, ticks: { callback: v => v+'%' } } } } });

        // Safety Event Recording Rate Chart
        const safetyRateData = { labels: qualityData.map(d=>d.name), values: qualityData.map(d=>d.safetyRate) };
        let safetyRateChart = new Chart(document.getElementById('safetyRateChart'), { type: 'bar', data: { labels: safetyRateData.labels, datasets: [{ label: 'Recording Rate (per 1,000 bed days)', data: safetyRateData.values, backgroundColor: '#007B7F', borderRadius: 6 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, max: 100 } } } });
        function sortSafetyChart(sortType) {
            let indices = safetyRateData.labels.map((_,i) => i);
            if (sortType === 'lowest') indices.sort((a,b) => safetyRateData.values[a] - safetyRateData.values[b]);
            else if (sortType === 'highest') indices.sort((a,b) => safetyRateData.values[b] - safetyRateData.values[a]);
            safetyRateChart.data.labels = indices.map(i => safetyRateData.labels[i]);
            safetyRateChart.data.datasets[0].data = indices.map(i => safetyRateData.values[i]);
            safetyRateChart.update();
        }

        // Safety Volume: incidents vs bed days with rate overlay
        new Chart(document.getElementById('safetyVolumeChart'), { type: 'bar', data: { labels: qualityData.map(d=>d.name), datasets: [{ label: 'Safety Events (Q2)', data: qualityData.map(d=>d.incidents), backgroundColor: '#007B7F', borderRadius: 6, yAxisID: 'y' },{ label: 'Bed Days (Q2, thousands)', data: qualityData.map(d=>Math.round(d.bedDays/1000)), backgroundColor: '#94A3B8', borderRadius: 6, yAxisID: 'y' },{ label: 'Rate per 1,000 bed days', data: qualityData.map(d=>d.safetyRate), type: 'line', borderColor: '#F59E0B', backgroundColor: '#F59E0B', pointRadius: 6, pointBackgroundColor: '#F59E0B', yAxisID: 'y1', tension: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' }, tooltip: { callbacks: { label: function(ctx) { if (ctx.datasetIndex === 0) return ctx.parsed.y.toLocaleString()+' events'; if (ctx.datasetIndex === 1) return (ctx.parsed.y*1000).toLocaleString()+' bed days'; return ctx.parsed.y+' per 1,000'; } } } }, scales: { y: { type: 'linear', position: 'left', beginAtZero: true, title: { display: true, text: 'Count / Bed days (thousands)' } }, y1: { type: 'linear', position: 'right', beginAtZero: true, max: 100, grid: { drawOnChartArea: false }, title: { display: true, text: 'Rate per 1,000 bed days' } } } } });
    </script>
</body>
</html>
